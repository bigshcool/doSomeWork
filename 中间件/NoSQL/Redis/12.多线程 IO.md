# 多线程 I/O

```SH
################################ THREADED I/O #################################

# Redis is mostly single threaded, however there are certain threaded
# operations such as UNLINK, slow I/O accesses and other things that are
# performed on side threads.
#
# Now it is also possible to handle Redis clients socket reads and writes
# in different I/O threads. Since especially writing is so slow, normally
# Redis users use pipelining in order to speed up the Redis performances per
# core, and spawn multiple instances in order to scale more. Using I/O
# threads it is possible to easily speedup two times Redis without resorting
# to pipelining nor sharding of the instance.
#
# By default threading is disabled, we suggest enabling it only in machines
# that have at least 4 or more cores, leaving at least one spare core.
# Using more than 8 threads is unlikely to help much. We also recommend using
# threaded I/O only if you actually have performance problems, with Redis
# instances being able to use a quite big percentage of CPU time, otherwise
# there is no point in using this feature.
#
# So for instance if you have a four cores boxes, try to use 2 or 3 I/O
# threads, if you have a 8 cores, try to use 6 threads. In order to
# enable I/O threads use the following configuration directive:
#
# io-threads 4
#
# Setting io-threads to 1 will just use the main thread as usual.
# When I/O threads are enabled, we only use threads for writes, that is
# to thread the write(2) syscall and transfer the client buffers to the
# socket. However it is also possible to enable threading of reads and
# protocol parsing using the following configuration directive, by setting
# it to yes:
#
# io-threads-do-reads no
#
# Usually threading reads doesn't help much.
#
# NOTE 1: This configuration directive cannot be changed at runtime via
# CONFIG SET. Also, this feature currently does not work when SSL is
# enabled.
#
# NOTE 2: If you want to test the Redis speedup using redis-benchmark, make
# sure you also run the benchmark itself in threaded mode, using the
# --threads option to match the number of Redis threads, otherwise you'll not
# be able to notice the improvements.
```

## 1.io-threads

在redis里面多线程默认是关闭的，在机器的CPU核至少为4个的时候才建议开启，并且至少要预留一个核，并且使用8个线程时候会发现帮助不大，我们仅仅建议在你有非常明显的性能问题的时候使用IO线程，因为Redis将会占用非常多的CPU时间

```
# 可以看到cpu核心数量
lscpu
```

![image-20221129144434582](https://raw.githubusercontent.com/bigshcool/myPic/main/image-20221129144434582.png)

如果你有4个核心，建议使用2-3个IO线程；如果你有8个核心的话，可以试试6个线程

## 2.io-threads-do-reads

当I/O多线程开启的时候，我们默认认为他是只能用来写的，而不是用来读，通过io-threads-do-reads可以让IO线程可以读。

```sh
io-threads-do-reads yes
```

**但是帮助不大，就保持默认即可**