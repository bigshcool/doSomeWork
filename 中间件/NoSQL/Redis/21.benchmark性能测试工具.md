# benchmark性能测试工具

## 1.redis-benchmark位置

```sh
ll /usr/local/bin
```

![image-20221211224708487](https://raw.githubusercontent.com/bigshcool/myPic/main/image-20221211224708487.png)



### 2.redis-benchmark帮助文档

```sh
ubuntu@VM-24-5-ubuntu:~$ redis-benchmark --help
Usage: redis-benchmark [OPTIONS] [COMMAND ARGS...]

Options:
 -h <hostname>      Server hostname (default 127.0.0.1)
 -p <port>          Server port (default 6379)
 -s <socket>        Server socket (overrides host and port)
 -a <password>      Password for Redis Auth
 --user <username>  Used to send ACL style 'AUTH username pass'. Needs -a.
 -u <uri>           Server URI.
 -c <clients>       Number of parallel connections (default 50)
 -n <requests>      Total number of requests (default 100000)
 -d <size>          Data size of SET/GET value in bytes (default 3)
 --dbnum <db>       SELECT the specified db number (default 0)
 -3                 Start session in RESP3 protocol mode.
 --threads <num>    Enable multi-thread mode.
 --cluster          Enable cluster mode.
                    If the command is supplied on the command line in cluster
                    mode, the key must contain "{tag}". Otherwise, the
                    command will not be sent to the right cluster node.
 --enable-tracking  Send CLIENT TRACKING on before starting benchmark.
 -k <boolean>       1=keep alive 0=reconnect (default 1)
 -r <keyspacelen>   Use random keys for SET/GET/INCR, random values for SADD,
                    random members and scores for ZADD.
                    Using this option the benchmark will expand the string
                    __rand_int__ inside an argument with a 12 digits number in
                    the specified range from 0 to keyspacelen-1. The
                    substitution changes every time a command is executed.
                    Default tests use this to hit random keys in the specified
                    range.
                    Note: If -r is omitted, all commands in a benchmark will
                    use the same key.
 -P <numreq>        Pipeline <numreq> requests. Default 1 (no pipeline).
 -q                 Quiet. Just show query/sec values
 --precision        Number of decimal places to display in latency output (default 0)
 --csv              Output in CSV format
 -l                 Loop. Run the tests forever
 -t <tests>         Only run the comma separated list of tests. The test
                    names are the same as the ones produced as output.
                    The -t option is ignored if a specific command is supplied
                    on the command line.
 -I                 Idle mode. Just open N idle connections and wait.
 -x                 Read last argument from STDIN.
 --help             Output this help and exit.
 --version          Output version and exit.

Examples:

 Run the benchmark with the default configuration against 127.0.0.1:6379:
   $ redis-benchmark

 Use 20 parallel clients, for a total of 100k requests, against 192.168.1.1:
   $ redis-benchmark -h 192.168.1.1 -p 6379 -n 100000 -c 20

 Fill 127.0.0.1:6379 with about 1 million keys only using the SET test:
   $ redis-benchmark -t set -n 1000000 -r 100000000

 Benchmark 127.0.0.1:6379 for a few commands producing CSV output:
   $ redis-benchmark -t ping,set,get -n 100000 --csv

 Benchmark a specific command line:
   $ redis-benchmark -r 10000 -n 10000 eval 'return redis.call("ping")' 0

 Fill a list with 10000 random elements:
   $ redis-benchmark -r 10000 -n 10000 lpush mylist __rand_int__

 On user specified command lines __rand_int__ is replaced with a random integer
 with a range of values selected by the -r option.

```



### 3.redis-benchmark测试代码以及注释

- 测试代码

```sh
redis-benchmark -h 192.168.1.1 -p 6379 -n 200000 -c 100
```

- 输出解释

```sh
====== PING_MBULK ======                                                   
  200000 requests completed in 6.49 seconds #请求总数
  100 parallel clients # 并行客户端数量
  3 bytes payload #-d 参数决定，对于get/set操作的数据大小
  keep alive: 1# -k 参数决定，只有0与1的值，默认是1，1表示100都处于连接的情况，0表示断连后会在连接
  host configuration "save": 3600 1 300 100 60 10000 # 
  host configuration "appendonly": # AOF没有开启
  multi-thread: no # 多线程默认是关闭的

# 延迟百分比的分布
Latency by percentile distribution:
0.000% <= 0.471 milliseconds (cumulative count 2)
# 200000个请求 完成了 50% 
50.000% <= 1.615 milliseconds (cumulative count 100006)
# 剩余50%的一半是 25%
75.000% <= 1.895 milliseconds (cumulative count 150752)
87.500% <= 2.031 milliseconds (cumulative count 175985)
93.750% <= 2.127 milliseconds (cumulative count 187591)
96.875% <= 2.255 milliseconds (cumulative count 193811)
98.438% <= 2.439 milliseconds (cumulative count 196940)
99.219% <= 2.623 milliseconds (cumulative count 198438)
99.609% <= 3.759 milliseconds (cumulative count 199220)
99.805% <= 4.487 milliseconds (cumulative count 199610)
99.902% <= 5.487 milliseconds (cumulative count 199806)
99.951% <= 6.423 milliseconds (cumulative count 199904)
99.976% <= 6.679 milliseconds (cumulative count 199952)
99.988% <= 6.999 milliseconds (cumulative count 199976)
99.994% <= 7.231 milliseconds (cumulative count 199988)
99.997% <= 7.351 milliseconds (cumulative count 199994)
99.998% <= 7.407 milliseconds (cumulative count 199997)
99.999% <= 7.447 milliseconds (cumulative count 199999)
100.000% <= 7.479 milliseconds (cumulative count 200000)
100.000% <= 7.479 milliseconds (cumulative count 200000)

# 延迟的累计分布,几乎都是0.1ms统计一次
Cumulative distribution of latencies:
0.000% <= 0.103 milliseconds (cumulative count 0)
0.030% <= 0.503 milliseconds (cumulative count 60)
0.428% <= 0.607 milliseconds (cumulative count 857)
0.844% <= 0.703 milliseconds (cumulative count 1689)
1.308% <= 0.807 milliseconds (cumulative count 2617)
1.724% <= 0.903 milliseconds (cumulative count 3447)
2.650% <= 1.007 milliseconds (cumulative count 5299)
6.756% <= 1.103 milliseconds (cumulative count 13513)
14.210% <= 1.207 milliseconds (cumulative count 28420)
22.684% <= 1.303 milliseconds (cumulative count 45368)
32.591% <= 1.407 milliseconds (cumulative count 65182)
41.309% <= 1.503 milliseconds (cumulative count 82618)
49.374% <= 1.607 milliseconds (cumulative count 98748)
57.407% <= 1.703 milliseconds (cumulative count 114815)
67.034% <= 1.807 milliseconds (cumulative count 134069)
76.145% <= 1.903 milliseconds (cumulative count 152289)
85.942% <= 2.007 milliseconds (cumulative count 171884)
92.702% <= 2.103 milliseconds (cumulative count 185404)
99.508% <= 3.103 milliseconds (cumulative count 199017)
99.710% <= 4.103 milliseconds (cumulative count 199421)
99.870% <= 5.103 milliseconds (cumulative count 199739)
99.913% <= 6.103 milliseconds (cumulative count 199826)
99.990% <= 7.103 milliseconds (cumulative count 199981)
100.000% <= 8.103 milliseconds (cumulative count 200000)

Summary:
  # 每秒的吞吐量
  throughput summary: 30826.14 requests per second
  # 延迟总结 单位毫秒
  latency summary (msec):
  # 20W请求 平均一条  最小时长  50%请求平均                    最大处理时间                
          avg       min       p50       p95       p99       max
        1.623     0.464     1.615     2.167     2.551     7.479

```

- 其他常用参数

```sh
-q # 只需要总述性的
-t # 只要有命令
```

