# Redis的IO模型

Redis客户端提交的各种请求时如何被最终的Redis处理的?Redis处理客户端请求所采用的处理架构，成为Redis的IO模型，不同版本的Redis采用的IO模型时不同的。

## 1.单线程模型

对于Redis 3.0版本以及以前的版本，Redis的IO模型采用的是**纯粹的单线程模型**，即所有客户端的请求全部由一个线程处理，使用了**多路复用技术**。**redis 单线程指的是网络请求模块使用了一个线程，即一个线程处理所有网络请求，其他模块仍用了多个线程，也就是说Thread进行消息的处理的时候，是单线程的，但是如果要是IO操作的话可以进行fork出子线程处理做数据持久化操作（换句话理解分发器是Controller，Thread是Service只能有一个，然后Dao层可以有多个）**

![image-20221127153130039](https://raw.githubusercontent.com/bigshcool/myPic/main/image-20221127153130039.png)

​		**因为CPU不是Redis的瓶颈。Redis的瓶颈最有可能是机器内存或者网络带宽**，既然单线程容易实现，而且CPU不会成为瓶颈，那就顺理成章地采用单线程的方案了

## 2. 多线程模型

![image-20221127153531721](https://raw.githubusercontent.com/bigshcool/myPic/main/image-20221127153531721.png)

- 首先需要注意的是Socket到时间分发器的连接，不是随机的，而是轮询的，目的是为了负载均衡。
- O线程与主线程
  - IO线程:目的是接受客户端的请求然后解析客户端的请求，然后将解析完成的请求放在任务队列中。
  - 主线程：处理在任务队列中的数据，结合了多线程和单线程的优点，避免了数据安全性问题与事务控制，也无需考虑LPUSH与LPOP等命令的执行顺序，也加强了Redis性能。

## 3. 单线程性能计算

```
内存的响应时间(RT) 100ns

Redis每秒处理的读写请求的数量可以应该可以达到:1/1000ns = 10^9ns/100ns=10^7=1kw

实际情况是:Redis每秒可以处理8w-11w的读写请求

差距就在单线程
```

## 4.单线程与多线程的优缺点

- 单线程模型
  - 优点:可维护性高、性能高，不存在并发读写情况。
    - 采用单线程，避免了不必要的上下文切换和竞争条件，
    - 不存在多进程或者多线程导致的切换而消耗 CPU，
    - 不用去考虑各种锁的问题，不存在加锁释放锁操作，没有因为可能出现死锁而导致的性能消耗；
  - 缺点:
    - 性能会受影响、且由于单线程只使用一个处理器，所以会形成处理器的浪费。
- 多线程模型
  - 优点:结合了多线程与单线程的优点，避开了他们所有的不足。
  - 缺点:该模型没有明显不足，如果非要找到其不足的话就是，并非是一个真正意义上的”多线程“,因为真正处理"任务的线程任然是单线程”。所以对性能也是有些影响的。